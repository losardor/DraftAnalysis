Intention: 
1. A conference paper at the 7th International Workshop on Image Analysis Methods in the Plant Sciences, http://liris.univ-lyon2.fr/IAMPS2019/ (deadline April 2nd, which is short because we don’t have all the results yet).
2. A longer paper in Spring/Summer, when we have more results.
________________




An inexpensive and easy-to-use 3D plant scanner to automate the study of Arabidopsis thaliana’s phyllotaxy
How inexpensive phenotyping tools could revolutionize plant sciences


Introduction
The shape of a plant can provide insights into the processes that drive its growth. These processes depend on numerous factors. Some factors are specific to the plant, such as its genetic material, and some are external to the plant, such environmental conditions. [TODO: insert argument on why it is important to study this link] However, studies to link genetic features or environmental conditions to plant traits require the detailed analysis of a large number of plants that have been grown in controlled conditions. 
A study to relate the plants shape to possible factors requires researchers to have access to an inexpensive and easy-to-use phenotyping robot. The robot should be able to scan a minimum of a 100 plants a day, have a small footprint so that it does not require a dedicated space, and cost less than 10 000 euros so that is accessible for individual research projects. It should have an automatic processing pipeline that starts from the sensors data and outputs the relevant plant traits.
We have made good progress in developing such a phenotyping station. In this paper we report on the first version that we have built and on the results we obtained in our study on the phyllotaxy of the Arabidopsis thaliana. Our evaluation shows that the scanner is X% faster than a human operator and that the average error on the angles is N°, which is less than the error made by manual measurements. 
Although we currently use the station indoor in a laboratory setting, some of the design choices we have made stem from a long-term effort to develops robotic tools for crop monitoring on farms. We envision to use the same tools to scan plants in the field. This data may help predict when and where a farmer will have to intervene by detecting anomalies in the plant’s development early on. We also hope that the scans of the outdoor plants may complement the indoor data obtained by research laboratories. Although the growing conditions on the farm cannot be controlled, it will be possible to collect much larger datasets.
However, to bootstrap this ambitious project on a sound basis we must first validate our work on a well-defined problem. We started with the phenotyping of the Arabidopsis thaliana in indoor settings. This focus allows us to validate our analysis results against a large body of published research data. 
More specifically, we are using the 3D scanner to analyse the positions of the flowers along the shoot of A. thaliana. When A. thaliana reaches maturity, its stem shoots up and flowers and fruits develop around the stem in a (mostly) spiral organisation. The phyllotaxy can be characterized by the angles and distances between successive fruits along the stem. On average, the angle is approximately 137 degrees. This pattern results from the interaction between three zones of stem cells in the apical meristem and the inhibiting effect of auxin in these zones [REF]. 
The arrangement of the fruits along the stem is not perfect and errors may appear. A common error is the inversion of the angles, where flowers with sequence numbers i=1, 2, 3, 4 at angles of 137° are produced in the order 1, 3, 2, 4 at angles 274°, 223°, and 274°. To understand whether the errors in the phyllotaxis are due to genetic expressions or to other factors, it is necessary to analyse large batches of plants of several genetic variations of A. thaliana grown in different conditions. 
The 3D scanner is the first step in the development of the phenotyping station needed for this study. 




The main body of work
The basic scanner consists of hardware and control software. The scanner has a main frame built of aluminium profiles. Its total size is 1.2m x 1.3m and 2.2m high. The frame holds the open-source CNC produced by X-Carve. On the z-axis of the CNC carries we mounted a gimbal to orient a Sony RX0 camera towards the plant. The components of the gimbal are produced using 3D printing technology. We also designed a controller board to position the brushless motor in the gimbal. It is based on the XXX chip and can be plugged into a standard Arduino XXX. The scanner is operated using a PC. The computer communicates with the CNC and the gimbal over serial connections and uses WiFi to communicate with the camera. This reduces the risk of cables becoming entangled in the gimbal. The camera is triggering using the Sony camera API. We then recover the images using a WiFi SD Card, which we found to be the most generic solution to the obtain high-resolution images. To interface with the scanner we have developed a open-source software library in Python. All code is accessible on Github. The total cost of the scanner is around 3000 euro. The task of automatically placing the potted plants in the scanner will be dealt with separately later on. 
[FIGURE: photo of the scanner]
We also implemented a first version of the data processing pipeline to extract the angles and internode distance of A. thaliana. The pipeline uses as input the high-resolution RGB images of the plant taken at different angles. It produces the list of angles and internode lengths as output. Figure X shows the different stages of the pipeline. Most of the steps use well-known techniques found in the literature. The steps that are specific to our work are XXX. [TODO] 
[FIGURE: schema of pipeline: The processing pipeline goes through the following steps. A) A neural network computes the masks that isolates the plant in the images from the background. B) The precise camera positions are computed using the Colmap software. C) The space carving technique uses these masks, the original images, and the camera positions to obtain the 3D shape of the plant. D) Using the signed distance transform and Delaunay triangulation the boundary skin of the plant is obtained as a mesh structure. E) The main skeleton is then obtained using active contours. F) The main stem is obtained as the longest path in the skeleton. G) The minimum spanning tree algorithm reduces this graph to a tree structure. H) The series of successive angles and internodes distances are obtained through the analysis of the tree structure.]
The scanner is a work in progress and therefore one 
Second, we generated sets of virtual plant images that were produced using a computational model of the A. thaliana. These models provide realistic reconstructions with known properties and provide a base truth against which we can test all the intermediate steps of the scanner. 


Evaluation
The results of the 3D scanner are satisfying. The speed-up of the scanner, compared to manual measurements, is N. The new station significantly increases the number of plants that we can analyse per day. The scan requires less than XX seconds to take N images. The extraction of the the angles and the internode distances requires YY seconds. A human operator needs approximately ZZ seconds per plant. 
We have evaluated the precision of the scanner in two ways. First, we compare the list of angles and internode distance to manual measurements on a set of stabilized “ground-truth” plants. Second, we generated sets of virtual plant images that were produced using a computational model of the A. thaliana. These models provide realistic reconstructions with known properties and provide a base truth against which we can test all the intermediate steps of the scanner. 
The scanner produces results with an error margin less than the error made by a human operator.  EXPAND
We also evaluated the precision of each step of the pipeline using synthetic data produced by a computational model of A. thaliana. EXPAND
Both evaluation strategies are used by incrementally improve the pipeline. 


Discussion
We have successfully made the first step towards an inexpensive, automatic phenotyping station to study the relation between the phyllotaxy of A. thaliana and genetics in detail. 
We will start using it in outdoor situations to evaluate how robust it is.   
We are making all information available online so that the scanner can be built and used by others too. Github, development methodology, forum, ...